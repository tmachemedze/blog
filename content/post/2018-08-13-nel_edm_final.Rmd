---
title: "Twitter campaign - Zimbabwean presidential elections 2018"
author: "Takwanisa Machemedze"
date: "2018-08-13"
output:
  blogdown::html_page
---

## Introduction

I recently attended a Summer School in Computational Social Science and found it interesting. My previous training and experience involves working with structured data such as household surveys.The summer course introduced me to text analysis among other topics.

One of the common applications of text analysis is social media analysis. After seeing various blogs analysing tweets of US presidential candidates and other prominent individuals, I thought it would be interesting to adapt this to the Zimbabwean presidential candidates following the recent harmonised elections. 

In the Zimbabwean situation, I am only considering the two leading presidential candidates, i.e., Emmerson Dambudzo Mnangagwa (@edmnangagwa) of ZANU-PF and Nelson Chamisa (@nelsonchamisa) the leader of the main opposition party. I am particularly interested with their social media activity in the period after the change of leadership in November 2017 following the fall of former president Robert Mugabe.  This happened about nine months before elections that were due in July/August 2018 (eventually held on 30 July 2018). Following events of November 2017, it was apparent that the ruling ZANU-PF has a new face on the ballot paper in nearly 40 years. This period also concides with the death of Morgan Tsvangirai (died 14 February 2018), the leading opposition figure for the past 20 years. He was also succeeded by Nelson Chamisa. Both Mnangagwa (EDM) and Chamisa (NC) are more active on twitter compared to their predecessors. The emergence of two new presidential candidates for the two main political parties provides us with an opportunity to examine their approaches to the elections through social media. Therefore, I am only considering the period 01-11-2017 to 13-08-2018.

Data was downloaded from the twitter API through the R statistical package and taking the most recent 3200 tweets. Both candidates do not tweet a lot such that the 3200 limit set by the twitter API covers tweets for the period of interest.

```{r, message=FALSE, warning=FALSE, echo=FALSE}
## Import data
library(rtweet)
library(tidyverse)
library(lubridate)
library(tidyquant)
library(tidytext)
library(SnowballC)

tweets <- read_twitter_csv("edm_nc_tweets.csv")

#table(tweets$screen_name)

tweets$time=ymd_hms(tweets$created_at)
tweets$year=as.numeric(year(tweets$created_at))
tweets$month=as.numeric(month(tweets$created_at))
tweets$clock=as.numeric(hour(tweets$created_at))

#=============================================================
#reduce to interval
interval <- c(interval(ymd("2017-11-01", tz = "UTC"), ymd("2018-08-13", tz = "UTC")))
reduced_tweets<-tweets %>% filter(time %within% interval) %>% 
  select(screen_name, source, created_at, text, favorite_count, is_retweet,time, year,month,clock) %>% 
  mutate(text=gsub("@\\w+ *", "",text)) %>% #remove handles with text
  mutate(text=gsub("#\\w+ *", "",text)) #remove hashtag
```

## Analysis

### Most liked tweets

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Thank you Zimbabwe!<br><br>I am humbled to be elected President of the Second Republic of Zimbabwe.<br><br>Though we may have been divided at the polls, we are united in our dreams.<br><br>This is a new beginning. Let us join hands, in peace, unity &amp; love, &amp; together build a new Zimbabwe for all! <a href="https://t.co/FbdrixAktR">pic.twitter.com/FbdrixAktR</a></p>&mdash; President of Zimbabwe (@edmnangagwa) <a href="https://twitter.com/edmnangagwa/status/1025155847691952129?ref_src=twsrc%5Etfw">August 2, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">THANK YOU ZIMBABWE ...I'm humbled by the support you have given to me as a Presidential Candidate. We have won the popular vote. You voted for total Change in this past election!We have won this one together. No amount of results manipulation will alter your WILL <a href="https://twitter.com/hashtag/Godisinit?src=hash&amp;ref_src=twsrc%5Etfw">#Godisinit</a></p>&mdash; Nelson Chamisa (@nelsonchamisa) <a href="https://twitter.com/nelsonchamisa/status/1024635326722174977?ref_src=twsrc%5Etfw">August 1, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

Their most liked tweets are about their proclamation of their "win" as presidential candidates.

### What do they use to tweet

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tab<-table(reduced_tweets$source, reduced_tweets$screen_name)
library(knitr)
kable(tab, format = "markdown", caption = "Platform used to tweet")
```

EDM generally use multiple devices/platforms (mainly Twitter for Android, Twitter for iPhone and Twitter Web Client.) whereas NC is an iPhone person. 

### Distribution of tweets

We take a look at the monthly distribution of tweets over the period. EDM has far fewer tweets (187) compared to NC (1167).

```{r, echo=FALSE}
reduced_tweets %>% 
  mutate(ym=ifelse(month<10,paste0(year,0,month),paste0(year,month))) %>% 
  mutate(ym=as.numeric(ym)) %>% 
  group_by(ym, screen_name) %>% 
  summarise(n=n()) %>%
  group_by(screen_name) %>% 
  mutate(p=round(n/sum(n)*100,2)) %>% 
  ggplot(.,aes(as.factor(ym),p,fill=screen_name))+
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8) +
  facet_wrap(~screen_name,nrow = 1) +
  labs(x="Year-Month", y="Percent") +
  theme_tq()+
  theme(legend.position = "none",axis.text.x=element_text(angle=90),plot.title=element_text(hjust=0.5))
```

EDM tweeted more in July 2018 building to the elections and Chamisa used twitter more in December 2017, most likely during the time when MT was not feeling well and him (NC) being prepared to lead the MDC Alliance campaign. It looks like Chamisa was tweeting less in the period immediately after the death of MT (Feb 2018) until May 2018. This is most probably because Chamisa was campaigning on the ground and had no time for social media. On the other hand EDM's team, if we are to believe that they hired a PR company ([see coltart](http://www.davidcoltart.com/2018/07/its-the-junta-stupid/)), doubled their efforts on social media in July. This was perhaps to sanitise their image and trying to appeal to a certain segment of the electorate other than the rural folk.

### What hour of the day do they tweet?

```{r, echo=FALSE}
reduced_tweets  %>%  
  filter(!(is_retweet=="True")) %>% 
  select(screen_name,clock) %>%  
  group_by(screen_name,clock) %>% 
  tally() %>% 
  group_by(screen_name) %>% 
  mutate(p=round(n/sum(n)*100,1)) %>% 
  ggplot(.,aes(clock,p,fill=screen_name,color=screen_name))+
  geom_point()+geom_line()+
  theme(legend.position="bottom",plot.title=element_text(hjust=0.5))+
  labs(x="Time(Hrs)",y="Prop. tweets",title="Tweet distribution by time")+
  scale_x_continuous(limits=c(0,23),breaks=seq(0,23,1)) +
  theme_tq() +
  scale_color_manual(values=c("darkgreen", "red"))
```

Clearly, NC starts social media work early than EDM. There are three significant peaks of tweeting during the hours: 5am-6am, 7am-8am and 9am-10am. EDM's team usually starts work between 7am-8am with a peak of tweets between 10am-11am.There is an interesting peak of EDM's tweets between 4pm and 5pm, i.e. before knocking-off.


### What did they tweet mostly about?

#### Most frequent words

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tweetwords <- reduced_tweets %>%
  unnest_tokens(word, text) %>%
  mutate(word_stem = wordStem(word)) %>% 
  anti_join(stop_words) %>% 
  filter(!grepl("\\.|http", word)) %>% #remove urls
  filter(!str_detect(word, "[0-9]"), #remove numbers
         word != "amp") #remove amp
#head(tweetwords)

tw<-tweetwords %>%   
  group_by(screen_name, word) %>% 
  drop_na(word) %>% 
  tally() %>% 
  top_n(20,n) %>% 
  ungroup() 

t1<-ggplot(tw %>% filter(screen_name=="edmnangagwa"), aes(reorder(word,n),n)) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8,show.legend = FALSE) +
  facet_wrap(~screen_name, ncol=2,scale="free")+
  theme_tq() +
  coord_flip() +
  labs(x="Word", y="count")

t2<-ggplot(tw %>% filter(screen_name=="nelsonchamisa"), aes(reorder(word,n),n)) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8,show.legend = FALSE) +
  facet_wrap(~screen_name, ncol=2,scale="free")+
  theme_tq() +
  coord_flip() +
  labs(x="Word", y="count")
cowplot::plot_grid(t1,t2,align="v")
```

Looking at the top 20 words used in their tweets, both have tweets to do with zimbabwe, people, time and
election. As expected, Chamisa also tweets more about change and victory. EDM's message has more to do with stability and building the economy - peace, create jobs, love, commitment, e.t.c.

#### TF-IDF

The most frequent words above do not provide a very useful metric.  Below we employ the `tf-idf` technique to extract the rare terms or most important terms used. These are the words that makes a difference in their tweets.

```{r, message=FALSE, warning=FALSE, echo=FALSE}
wordcounts <- tweetwords %>%
  count(screen_name, word, sort = TRUE) %>%
  ungroup()

#head(wordcounts)

#term frequency and inverse document frequency (tf_idf)

tweet_tfidf <- wordcounts %>%
  bind_tf_idf(word, screen_name, n) %>%
  arrange(desc(tf_idf))

tweet_tfidf %>%
  mutate(word = factor(word, levels = rev(unique(word)))) %>%
  group_by(screen_name) %>%
  top_n(15) %>%
  ungroup() %>%
  ggplot(aes(word, tf_idf, fill = screen_name)) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8,show.legend = FALSE) +
  labs(x = NULL, y = "tf-idf") +
  facet_wrap(~screen_name, ncol = 2, scales = "free") +
  theme_tq() +
  coord_flip()
```

The top 5 important words for EDM are energy (both "energy" of supporters during campaign and investment in "energy"). He is "delighted" and "urging" people to do something in the new "era" of his leadership. Of course he is systematic as he believes in things moving in "steps".

NC's important words include relationships as he refers to some of his followers as brothers (bro) and is cheerful as he expresses his laughter (lol). He warned (don't) and saw "victory" in the presidential elections "coming".

### Hashtag analysis

Top 10 hashtags

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tweets %>% 
  filter(time %within% interval) %>% 
  select(screen_name,text) %>% 
  mutate(hashtag=as.character(str_extract_all(text,"#\\S+"))) %>% 
  mutate(hashtag=ifelse(hashtag=='character(0)',NA,hashtag)) %>% 
  group_by(screen_name, hashtag) %>% 
  drop_na(hashtag) %>% 
  tally() %>% 
  arrange(desc(n)) %>% 
  #top_n(10) %>% same frequency for ED
  slice(1:10) %>%
  ggplot(., aes(reorder(hashtag,n),n)) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8,show.legend = FALSE) +
  facet_wrap(~screen_name, ncol=1,scale="free")+
  theme_tq() +
  coord_flip() +
  labs(x="Hashtag", y="count")
```

For EDM, #100daysofaction was the most popular (used 3 times) whereas NC had a religious tone (#godisinit used nearly fourty times). NC's hashtags are more creative compared to EDM's generic and international events.

### Retweet analysis

#### Whose tweets have the candidates retweeted the most?

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tweets %>%
  filter(time %within% interval) %>% 
  select(screen_name,is_retweet,retweet_name, retweet_screen_name) %>% 
  filter(is_retweet=="TRUE")  %>% 
  group_by(screen_name,retweet_screen_name) %>% 
  tally() %>% 
  arrange(desc(n)) %>% 
  top_n(10) %>% 
  ggplot(., aes(reorder(retweet_screen_name,n),n)) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8,show.legend = FALSE) +
  facet_wrap(~screen_name, scale="free")+
  theme_tq() +
  coord_flip() +
  labs(x="Retweeted handle", y="count")
```

EDM retweets mostly from the ZBCNewsonline (the national broadcaster) and the US Embassy in Harare. NC retweets mostly from individuals - stacy_nyathi and MakomboreroH, and from the official opposition party handle (mdczimbabwe). It is notable that EDM does not retweet from the official ZANU-PF handle, but prominent individuals and international organizations. One possible explanation is that his team try to amplify any positive message of potential relationships with significant institutions.

### Sentiment analysis

For sentiment analysis, two lexicons were used. The first one is the `bing` lexicon that categorize words into positive and negative categories, and the `nrc` lexicon that categorizes words into emotions of positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust.

#### Bing

The graph below shows the proportion of the sentiments after using the `bing` dictionary that categorizes words as either positive or negative, correcting for negated words like "not happy" as negative.

```{r, echo=FALSE}
bigrams_separated <- reduced_tweets %>%
  select(text, screen_name) %>% 
  unnest_tokens(output=bigram, input=text, token = "ngrams", n = 2) %>%  
  #filter(!grepl("\\.|http", bigram)) %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  filter(word1 == "not" | word1 == "no") %>%
  filter(!word2 %in% stop_words$word)

# Sentiment analysis
tidy_tweetwords_sentiment <- tweetwords %>%
  left_join(select(bigrams_separated, word1, word2), by = c("word" = "word2")) %>%
  inner_join(get_sentiments("nrc"), by = "word") %>%
  inner_join(get_sentiments("bing"), by = "word") %>%
  rename(nrc = sentiment.x, bing = sentiment.y) %>%
  mutate(nrc = ifelse(!is.na(word1), NA, nrc),
         bing = ifelse(!is.na(word1) & bing == "positive", "negative", 
                       ifelse(!is.na(word1) & bing == "negative", "positive", bing)))

tidy_tweetwords_sentiment %>%
  group_by(screen_name, bing) %>% 
  summarise(count=n()) %>%
  group_by(screen_name) %>% 
  mutate(p=count/sum(count)*100) %>%  
  ggplot(.,aes(x = bing, y = p)) +
  facet_wrap(~ screen_name) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8) +
  scale_y_continuous(limits=c(0,100),breaks=seq(0,100,20)) +
  coord_flip() +
  theme_tq() +
  labs(x = "",
       y = "Proportion of sentiment in tweets (bing)")
```

EDM expresses more positive sentiment (over 80% of words used) compared to NC (just under 60%). 

#### nrc

Figure below shows the alternative sentiment analysis using the nrc lexicon that categories words into emotions.

```{r, echo=FALSE}
tidy_tweetwords_sentiment %>%
  filter(nrc != "positive") %>%
  filter(nrc != "negative") %>%
  group_by(screen_name, nrc) %>% 
  summarise(count=n()) %>%
  group_by(screen_name) %>% 
  mutate(p=count/sum(count)*100) %>%
  ggplot(.,aes(x = reorder(nrc, count), y = p)) +
  facet_wrap(~ screen_name) +
  geom_col(color = palette_light()[1], fill = palette_light()[1], alpha = 0.8) +
  scale_y_continuous(limits=c(0,100),breaks=seq(0,100,20)) +
  coord_flip() +
  theme_tq() +
  labs(x = "",
       y = "Proportion of sentiment in tweets (nrc)")
```

For both candidates, there is relatively more expression of joy, trust and anticipation where this is more for EDM compared to NC. Conversely, EDM expresses less sadness, anger, fear, disgust than NC.However, EDM expresses more suprise than NC.

## How did the sentiment change over time?

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tweetwords_1 <- reduced_tweets %>%
  unnest_tokens(word, text) %>%
  mutate(word_stem = wordStem(word)) %>% 
  mutate(ym=ifelse(month<10,paste0(year,0,month),paste0(year,month))) %>% 
  mutate(ym=as.numeric(ym)) %>%
  anti_join(stop_words) %>% 
  filter(!grepl("\\.|http", word)) %>% #remove urls
  filter(!str_detect(word, "[0-9]"), #remove numbers
         word != "amp") #remove amp

bigrams_separated_1 <- reduced_tweets %>%
  mutate(ym=ifelse(month<10,paste0(year,0,month),paste0(year,month))) %>% 
  mutate(ym=as.numeric(ym)) %>% 
  select(text, screen_name,ym) %>% 
  unnest_tokens(output=bigram, input=text, token = "ngrams", n = 2) %>%  
  #filter(!grepl("\\.|http", bigram)) %>%
  separate(bigram, c("word1", "word2"), sep = " ") %>%
  filter(word1 == "not" | word1 == "no") %>%
  filter(!word2 %in% stop_words$word)

# Sentiment analysis
tidy_tweetwords_sentiment_1 <- tweetwords_1 %>%
  left_join(select(bigrams_separated_1, word1, word2,ym), by = c("word" = "word2", "ym")) %>%
  inner_join(get_sentiments("nrc"), by = "word") %>%
  inner_join(get_sentiments("bing"), by = "word") %>%
  rename(nrc = sentiment.x, bing = sentiment.y) %>%
  mutate(nrc = ifelse(!is.na(word1), NA, nrc),
         bing = ifelse(!is.na(word1) & bing == "positive", "negative", 
                       ifelse(!is.na(word1) & bing == "negative", "positive", bing)))
```

#### Within individual

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tidy_tweetwords_sentiment_1 %>%
  group_by(screen_name, ym,bing) %>% 
  summarise(count=n()) %>%
  group_by(screen_name,ym) %>% 
  mutate(p=count/sum(count)*100) %>%   
  ggplot(.,aes(x = as.numeric(as.factor(ym)), y = p, color=bing)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ screen_name) +
  theme_tq() +
  theme(axis.text.x=element_text(angle=90),plot.title=element_text(hjust=0.5)) +
  scale_x_discrete(limits=c("201711", "201712", "201801", "201802", "201803", "201804", "201805", "201806", "201807", "201808"))+
  labs(x = "Year-Month",
       y = "Proportion of sentiment in tweets (bing)")+
  scale_color_manual(values=c("darkgreen", "red")) 
```

Generally, they both express positive sentiments (more positive than negative).

#### Between individuals

```{r, message=FALSE, warning=FALSE, echo=FALSE}
tidy_tweetwords_sentiment_1 %>%
  group_by(screen_name, ym,bing) %>% 
  summarise(count=n()) %>%
  group_by(screen_name,ym) %>% 
  mutate(p=count/sum(count)*100) %>%   
  ggplot(.,aes(x = as.numeric(as.factor(ym)), y = p, color=screen_name)) +
  geom_point() +
  geom_line() +
  facet_wrap(~ bing) +
  theme_tq() +
  theme(axis.text.x=element_text(angle=90),plot.title=element_text(hjust=0.5)) +
  scale_x_discrete(limits=c("201711", "201712", "201801", "201802", "201803", "201804", "201805", "201806", "201807", "201808"))+
  labs(x = "Year-Month",
       y = "Proportion of sentiment in tweets (bing)")+
  scale_color_manual(values=c("darkgreen", "red"))
```

Generally, ED is less negative in his tweets relative to Chamisa. For both candidates, there is no increasing trend of negative sentiments towards election time.

## Conclusion

NC's most frequent words, retweets, hashtags and sentiments appear to be real expressions of his feelings and emotions. EDM's tweets have a more structured message. Other than that he is the president, older and perhaps more mature, his tweets also appear to support the argument that he uses a PR company to enhance his image. It would be interesting to analyse their off the cuff campaign messages and compare with their tweets. 

